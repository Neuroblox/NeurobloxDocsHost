<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Resting state simulation using neural mass models · Neuroblox</title><meta name="title" content="Resting state simulation using neural mass models · Neuroblox"/><meta property="og:title" content="Resting state simulation using neural mass models · Neuroblox"/><meta property="twitter:title" content="Resting state simulation using neural mass models · Neuroblox"/><meta name="description" content="Documentation for Neuroblox."/><meta property="og:description" content="Documentation for Neuroblox."/><meta property="twitter:description" content="Documentation for Neuroblox."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Neuroblox logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Neuroblox</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Neuroblox</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Resting state simulation using neural mass models</a></li><li><a class="tocitem" href="../parkinsons/">Building a model of Parkinson&#39;s disease using Neural Mass models</a></li><li><a class="tocitem" href="../neural_assembly/">Tutorial on bottom-up approach to building a neural assembly</a></li><li><a class="tocitem" href="../ping_network/">Pyramidal-Interneuron Gamma network</a></li><li><a class="tocitem" href="../spectralDCM/">Spectral Dynamic Causal Modeling Tutorial</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../release_notes/">Release Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Resting state simulation using neural mass models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Resting state simulation using neural mass models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Neuroblox/Neuroblox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Neuroblox/Neuroblox.jl/blob/master/docs/src/tutorials/resting_state.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Resting-state-simulation-using-neural-mass-models"><a class="docs-heading-anchor" href="#Resting-state-simulation-using-neural-mass-models">Resting state simulation using neural mass models</a><a id="Resting-state-simulation-using-neural-mass-models-1"></a><a class="docs-heading-anchor-permalink" href="#Resting-state-simulation-using-neural-mass-models" title="Permalink"></a></h1><p>This tutorial will introduce you to simulating resting state brain dynamics using Neuroblox. We will be using the FitzHugh-Nagumo model as a building block. The FitzHugh-Nagumo model is described by the follwoing equations:</p><p class="math-container">\[       \begin{align}
       \dot{V} &amp;= d \, \tau (-f V^3 + e V^2 + \alpha W - \gamma I_{c} + \sigma w(t) ) \\
       \dot{W} &amp;= \dfrac{d}{\tau}\,\,(b V - \beta W + a + \sigma w(t) )
       \end{align}\]</p><p>We start by building the resting state circuit from individual Generic2dOscillator Blox</p><pre><code class="language-julia hljs">using Neuroblox
using CSV
using DataFrames
using StochasticDiffEq
using Random
using CairoMakie
using Statistics
using HypothesisTests

# read connection matrix from file
weights = CSV.read(&quot;../data/weights.csv&quot;,DataFrame)
region_names = names(weights)

wm = Array(weights) ## transform the weights into a matrix
N_bloxs = size(wm)[1] ## number of blox components

# create an array of neural mass models
blocks = [Generic2dOscillator(name=Symbol(region_names[i]),bn=sqrt(5e-4)) for i in 1:N_bloxs]

# add neural mass models to Graph and connect using the connection matrix
g = MetaDiGraph()
add_blox!.(Ref(g), blocks)
create_adjacency_edges!(g, wm)

@named sys = system_from_graph(g);</code></pre><p>To solve the system, we first create an Stochastic Differential Equation Problem and then solve it using a EulerHeun solver. The solution is saved every 0.5 ms. The unit of time in Neuroblox is 1 ms.</p><pre><code class="language-julia hljs">prob = SDEProblem(sys,rand(-2:0.1:4,76*2), (0.0, 6e5), [])
sol = solve(prob, EulerHeun(), dt=0.5, saveat=5)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 120001-element Vector{Float64}:
      0.0
      5.0
     10.0
     15.0
     20.0
     25.0
     30.0
     35.0
     40.0
     45.0
      ⋮
 599960.0
 599965.0
 599970.0
 599975.0
 599980.0
 599985.0
 599990.0
 599995.0
 600000.0
u: 120001-element Vector{Vector{Float64}}:
 [0.2, -0.5, 2.5, -1.8, 3.9, 1.0, -2.0, 1.0, 2.1, 2.5  …  -0.4, 1.9, 0.8, 0.9, 2.5, -1.3, 3.9, -0.8, -0.6, 0.9]
 [0.10618434180935253, -0.7909998034323665, 2.485888104582519, -4.2938478229815455, 3.155886600723451, -2.5785780051031213, -1.0379781797256795, 2.0448112231217856, 2.466256493642477, -0.01676361218841238  …  -0.4086971950883478, 1.852448044271983, 0.4986457374440802, 0.01911662602182891, 2.403425666786471, -3.70740171442356, 3.0455867380312847, -4.0847984864025575, -0.388515511934126, 0.9835150821654421]
 [-0.02948641798844843, -0.9636532768600484, 2.190476510829872, -6.387498598987694, 2.73736204286623, -5.323807421302304, -0.7901175308300441, 2.4058477097262077, 2.4712107269901273, -2.5452654915057877  …  -0.3654109004146674, 1.7659634525677483, 0.15029944949861018, -0.49939693877867297, 2.1790638598837684, -5.805274585497433, 2.514247784821579, -6.4871141236187855, -0.2830474830577593, 0.9495296379738594]
 [-0.15017338265840413, -0.9390892976874347, 1.7149068728815953, -7.915567033484017, 2.310427776632501, -7.4159580176956315, -0.524670429207236, 2.6606652896911505, 2.265370439397784, -4.7205616264383  …  -0.30495799088556735, 1.740937081210343, -0.24006044511834154, -0.6081886361554953, 1.7648591473944852, -7.345703793037979, 2.009700717836705, -8.235784009347825, -0.09921760149330232, 0.8998000141747594]
 [-0.2850250803841063, -0.8513051017553043, 1.100065094178003, -8.731204470059778, 1.8521069225860132, -8.884205599462184, -0.41554085888006925, 2.6478461332955767, 2.0036347676632076, -6.447704088056656  …  -0.23474076889378176, 1.6987976141472616, -0.5077168840987082, -0.35941552480439964, 1.1663776660671648, -8.2228087486978, 1.4194334755376896, -9.246563977113858, 0.010220521427980443, 0.6505041570817407]
 [-0.43023886168392844, -0.5391461504251828, 0.28245897005495135, -8.828496349999646, 1.2431857509106243, -9.608084753479385, -0.29219475926249544, 2.5447201484247763, 1.5756542607500144, -7.717187525481766  …  -0.17055514051558107, 1.575066356921538, -0.5337312323420353, -0.051758936588130564, 0.4845613143832799, -8.440222433550506, 0.6046571704806853, -9.542746611179235, 0.07963903077229254, 0.4230226861426341]
 [-0.39323900498742137, -0.23816975722331685, -0.5703562523945847, -8.061968537890067, 0.35985972527482035, -9.616676027397046, -0.22376993937543355, 2.3268964821833706, 0.9328163989510623, -8.477355064971695  …  -0.06964841635804722, 1.345256995550711, -0.5070196357718231, 0.2107731186536685, -0.3510693862451941, -7.846412351587227, -0.36010762163163396, -8.936190674414695, 0.23922791373222924, -0.0014350141729209745]
 [-0.30565389779640356, -0.05438752850294101, -0.9965621026462118, -6.722345404446702, -0.5183287174607334, -8.734591657740449, 0.015966827958334446, 2.098786421213928, 0.1326879403813556, -8.365682223844843  …  0.0549904043840649, 1.0337057575725737, -0.37371910390330576, 0.37800321342111454, -0.9188028161157292, -6.548150739844876, -0.902434900136749, -7.626052811641911, 0.23987187818056468, -0.5238408429105278]
 [-0.28548121592193626, -0.01877366698470155, -1.1376349157171028, -5.285265224801131, -1.072237485771243, -7.3094296666565, 0.13802489218044173, 1.6536592037156963, -0.6395432635906323, -7.4500286433558  …  0.27810241310694306, 0.6234515916298347, -0.22827416359461913, 0.48375221907857696, -1.0468022565647426, -5.234165320609798, -1.0549050764166699, -6.1503010068016435, 0.13192805932250923, -0.8474184385633226]
 [-0.27159267796946657, 0.013573320334135639, -1.0895788627629126, -3.9054203266171834, -1.1826296095051558, -5.705466615082172, 0.349780047889901, 0.9948190800349153, -0.9877927520119417, -6.097945366179246  …  0.36885495666987234, -0.053127004450786414, -0.0315798617462677, 0.30919218640903984, -1.0196272257931205, -3.801886356751487, -1.0652075639934946, -4.716054406746501, -0.0033065940125036695, -1.0434175305013138]
 ⋮
 [-0.200474359947697, -0.6119911938918782, -0.08788724335585123, -0.4927868998062428, -0.12250552301999228, -1.1847276877551238, 0.06792043488111431, -0.6683957744924665, -0.2242290404873433, -0.6015448422125798  …  -0.10539991410271915, -0.8539215673515684, 0.017685643483974497, -0.519341214142533, -0.0967598955879124, -0.23930604569773675, -0.26608808258168815, -0.3520635373828056, -0.2522510090756478, 0.04282451129271618]
 [-0.23828407612431074, -0.6592120528548086, -0.08281005447502272, -0.534516197811334, -0.21185041971204588, -1.154143758072605, 0.11488921666358375, -0.8523650237108656, -0.18168876516624666, -0.54612710674635  …  -0.1152904843420484, -0.8005209934312927, 0.050947555563804064, -0.6701605698885162, -0.09157063869722291, -0.40866728555438125, -0.233442744627907, -0.2092538168131971, -0.23801015927044789, 0.08487384144793253]
 [-0.18590603449770454, -0.6002056267786819, -0.07634355704460283, -0.6700526755203025, -0.3432051633557048, -0.9506063230349792, 0.08552425184897201, -1.0800552634768334, -0.050175784979212365, -0.6116698324930191  …  -0.12256985124289027, -0.7246296151637973, -0.07939976170089873, -0.7504203416561659, -0.06495941622851824, -0.4688926274827702, -0.19771301164543484, -0.2188988958042581, -0.20559004398559946, 0.1365369352390001]
 [-0.18330289038022451, -0.5711776925887281, -0.1690358339767626, -0.7047461947935596, -0.32999504020791387, -0.7686249173015388, 0.08017646568412075, -1.2270041352724161, -0.03533748949021916, -0.6350608378611645  …  -0.17931911399586756, -0.7489183807814805, -0.04219269098604749, -0.8721305046499297, -0.1485027154821334, -0.5487843432354873, -0.124190445755185, -0.22521016243579164, -0.16150877617273088, 0.06890352135032295]
 [-0.22938609888251546, -0.4750521831948947, -0.21282540023266378, -0.7212766496688567, -0.3186566243235015, -0.5351202420065254, -0.001242760445422087, -1.298514335990133, -0.06811394449700237, -0.6987536263219565  …  -0.21691598764466616, -0.6758800921326581, -0.055355984901249586, -0.9752358680183838, -0.1775168707989607, -0.5401670230078733, -0.012980570476395501, -0.4215407070677418, -0.06725240080011508, 0.0004737057056041303]
 [-0.2636979011625973, -0.3508031442845524, -0.2065038483627935, -0.5921163623467024, -0.3522080855591232, -0.3540999364542847, -0.11991456147991646, -1.1983196399014304, -0.18064948437702705, -0.8014981917290688  …  -0.23295829175327964, -0.5247706367232057, -0.06874877433792459, -1.0655150296811073, -0.33535556490033047, -0.5276221513379019, -0.03373835237937907, -0.5906774397803933, -0.12323580464609148, -0.04688273477094752]
 [-0.3071278910206698, -0.17296524512664316, -0.15780329941703528, -0.5721886425498894, -0.3403437481378565, -0.22224330114485757, -0.15973827225959228, -1.2015831627946338, -0.1571338331290802, -0.7295417341601893  …  -0.19057071034088532, -0.47632341549020196, -0.16359476308878443, -1.0405329203730518, -0.31530006038484765, -0.34307136875560806, -0.018467108472210232, -0.6216283392675162, -0.21407130494145368, -0.16497552140858146]
 [-0.20655590357048592, -0.15049422894694275, -0.17227134220853957, -0.6199686890228168, -0.3484277907152561, -0.05215717378377197, -0.1863421080019785, -1.0908799500272304, -0.258040361521865, -0.6639450171454244  …  -0.19247873380443256, -0.4608523531461241, -0.15307629752011664, -0.9261580910398962, -0.21714359853095688, -0.22731089394366974, -0.02006363393593098, -0.7479126779121602, -0.1837377240365004, -0.07328854673428623]
 [-0.18258705780172577, -0.18251152420765263, -0.23377860867918368, -0.5765594045472591, -0.2703371677763675, 0.06868831737300786, -0.11528764579104597, -0.9816624416278741, -0.18988977399258591, -0.5197797069301814  …  -0.21472109328701935, -0.3892491214094205, -0.1576242980863146, -0.9304996505817819, -0.24096715709052005, -0.23476632170666156, -0.10056232088966209, -0.8301570924514328, -0.19876925848305416, -0.08252896602788029]</code></pre><p>Let us plot the voltage potential of the first couple of components</p><pre><code class="language-julia hljs">v1 = voltage_timeseries(blocks[1], sol)
v2 = voltage_timeseries(blocks[2], sol)

fig = Figure()
ax = Axis(fig[1,1]; xlabel = &quot;time (ms)&quot;, ylabel = &quot;Potential&quot;)
lines!(ax, sol.t, v1)
lines!(ax, sol.t, v2)
xlims!(ax, (0, 1000)) ## limit the x-axis to the first second of simulation
fig</code></pre><img src="6b5271d7.png" alt="Example block output"/><p>To evaluate the connectivity of our simulated resting state network, we calculate the statistically significant correlations</p><pre><code class="language-julia hljs">cs = []
for i in 1:Int((length(sol.t)-1)/1000)-1
    solv = Array(sol[1:2:end,(i-1)*1000+1:(i*1000)])&#39;
    push!(cs,cor(solv))
end
css = stack(cs)

p = zeros(76,76)
for i in 1:76
    for j in 1:76
        p[i,j] = pvalue(OneSampleTTest(css[i,j,:]))
    end
end

heatmap(log10.(p) .* (p .&lt; 0.05))</code></pre><img src="0fe3d892.png" alt="Example block output"/><p>Fig.: log10(p value) displaying statistally significant correlation between time series</p><pre><code class="language-julia hljs">heatmap(wm)</code></pre><img src="97dcf012.png" alt="Example block output"/><p>Fig.: Connection Adjacency Matrix that was used to connect the neural mass models</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../parkinsons/">Building a model of Parkinson&#39;s disease using Neural Mass models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 7 October 2024 22:31">Monday 7 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
