<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Resting state simulation using neural mass models · Neuroblox</title><meta name="title" content="Resting state simulation using neural mass models · Neuroblox"/><meta property="og:title" content="Resting state simulation using neural mass models · Neuroblox"/><meta property="twitter:title" content="Resting state simulation using neural mass models · Neuroblox"/><meta name="description" content="Documentation for Neuroblox."/><meta property="og:description" content="Documentation for Neuroblox."/><meta property="twitter:description" content="Documentation for Neuroblox."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Neuroblox logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Neuroblox</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Neuroblox</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Resting state simulation using neural mass models</a></li><li><a class="tocitem" href="../parkinsons/">Building a model of Parkinson&#39;s disease using Neural Mass models</a></li><li><a class="tocitem" href="../neural_assembly/">Tutorial on bottom-up approach to building a neural assembly</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../release_notes/">Release Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Resting state simulation using neural mass models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Resting state simulation using neural mass models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Neuroblox/Neuroblox.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Neuroblox/Neuroblox.jl/blob/master/docs/src/tutorials/resting_state.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Resting-state-simulation-using-neural-mass-models"><a class="docs-heading-anchor" href="#Resting-state-simulation-using-neural-mass-models">Resting state simulation using neural mass models</a><a id="Resting-state-simulation-using-neural-mass-models-1"></a><a class="docs-heading-anchor-permalink" href="#Resting-state-simulation-using-neural-mass-models" title="Permalink"></a></h1><p>This tutorial will introduce you to simulating resting state brain dynamics using Neuroblox. We will be using the FitzHugh-Nagumo model as a building block. The FitzHugh-Nagumo model is described by the follwoing equations:</p><p class="math-container">\[       \begin{align}
       \dot{V} &amp;= d \, \tau (-f V^3 + e V^2 + \alpha W - \gamma I_{c} + \sigma w(t) ) \\
       \dot{W} &amp;= \dfrac{d}{\tau}\,\,(b V - \beta W + a + \sigma w(t) )
       \end{align}\]</p><p>We start by building the resting state circuit from individual Generic2dOscillator Blox</p><pre><code class="language-julia hljs">using Neuroblox
using CSV
using DataFrames
using DifferentialEquations
using Random
using CairoMakie
using Statistics
using HypothesisTests

# read connection matrix from file
weights = CSV.read(&quot;../data/weights.csv&quot;,DataFrame)
region_names = names(weights)

wm = Array(weights) ## transform the weights into a matrix
N_bloxs = size(wm)[1] ## number of blox components

# create an array of neural mass models
blocks = [Generic2dOscillator(name=Symbol(region_names[i]),bn=sqrt(5e-4)) for i in 1:N_bloxs]

# add neural mass models to Graph and connect using the connection matrix
g = MetaDiGraph()
add_blox!.(Ref(g), blocks)
create_adjacency_edges!(g, wm)

@named sys = system_from_graph(g);</code></pre><p>To solve the system, we first create an Stochastic Differential Equation Problem and then solve it using a EulerHeun solver. The solution is saved every 0.5 ms. The unit of time in Neuroblox is 1 ms.</p><pre><code class="language-julia hljs">prob = SDEProblem(sys,rand(-2:0.1:4,76*2), (0.0, 6e5), [])
sol = solve(prob, EulerHeun(), dt=0.5, saveat=5)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 120001-element Vector{Float64}:
      0.0
      5.0
     10.0
     15.0
     20.0
     25.0
     30.0
     35.0
     40.0
     45.0
      ⋮
 599960.0
 599965.0
 599970.0
 599975.0
 599980.0
 599985.0
 599990.0
 599995.0
 600000.0
u: 120001-element Vector{Vector{Float64}}:
 [0.2, 1.3, 3.7, 2.7, -0.1, 0.1, 0.5, 2.8, 0.2, -0.5  …  2.7, -1.9, -1.1, 3.8, -2.0, 1.4, 2.7, -2.0, -1.3, 1.6]
 [0.07803175473334997, 0.8390620685045582, 3.09994074012361, -0.9760657404435493, -0.23883304643736283, 0.08039197599517321, 0.6436946467666751, 1.7637471551524015, -0.04515803872792887, -0.6961555006053297  …  2.22830605655357, -4.299725555865147, -0.7073969724365464, 4.042145024291495, -0.9719262355169284, 2.4039658954224987, 2.4684810338618064, -4.469645805600868, -0.6575568931310797, 2.0870553046398093]
 [-0.17600266868609843, 0.6709482475521474, 2.6711776035238284, -3.825079603557475, -0.2585371488417974, 0.10760264600524934, 0.6280834935510644, 0.7765018540985431, -0.23347959375157581, -0.6862216392937053  …  1.7630102847386102, -6.048872735842139, -0.33544913372875207, 3.8373019062758864, -0.5546300926390256, 2.6472770859653574, 2.0351138047542383, -6.340029671259791, -0.36660788415537526, 2.0878185314602264]
 [-0.30966913462120443, 0.6505477399727276, 2.2021886389378658, -6.012650429108656, -0.27021000334682665, 0.05901715792744301, 0.49902334538981435, 0.0382988118430215, -0.3816530287006198, -0.42221950436095645  …  1.2182537759143361, -7.162951575445175, -0.05801415800243719, 3.4758170031269646, -0.24684805696836637, 2.6532143106173516, 1.593016128228346, -7.68122749550165, -0.1788815099791649, 1.8766513619904548]
 [-0.33625360895951534, 0.7409644430879743, 1.7620186727287437, -7.537477705574842, -0.2948402666853068, 0.11279432499976595, 0.30303129996447087, -0.5580848837094123, -0.46495990313158275, -0.1367777660882098  …  0.5825280203560961, -7.565416667272049, 0.20568976974875125, 2.978874000067357, -0.06581753616984495, 2.375112175478583, 0.9076989653466689, -8.257024539621867, 0.0909105707770302, 1.5645559316233986]
 [-0.31756502905730377, 0.9048723734560944, 1.184047973825277, -8.44788531365724, -0.27417031094562483, 0.16602651375151617, 0.16591424012005573, -0.9540515634130442, -0.47895739980188357, 0.14297245913398313  …  -0.2146386689458184, -7.240233265028326, 0.44841302125996374, 2.1592469832336127, 0.08049312893253363, 1.9790007224172004, 0.09966893875476693, -8.113564306575544, 0.17748791310989323, 1.0485380781580296]
 [-0.3005011479851588, 0.881274505374976, 0.5222698087193434, -8.680789309671642, -0.28429874828817603, 0.2449868315956852, -0.017842445543494415, -1.186624766796719, -0.5004460079647204, 0.38898096534033166  …  -0.820128220086316, -6.276893466443358, 0.6993148912191737, 1.18685144909898, 0.21379690028854687, 1.4019109155717628, -0.5954369549903908, -7.262748718507008, 0.24203339184577907, 0.5675542680972071]
 [-0.2115328369991206, 0.8862916836421244, -0.36909795930777656, -8.095495019814244, -0.279110529007634, 0.32633805066600635, -0.012509819974777434, -1.276134070998354, -0.3711347760180263, 0.5370896173570643  …  -0.9881553854339489, -4.920596794084779, 0.8479378547927431, 0.11858203661555783, 0.29942928738206215, 0.8809971654660983, -0.9413419526892961, -6.000410400103832, 0.2675086611369469, 0.00022703070109964668]
 [-0.059114549069058595, 0.7298489515139063, -0.965481439332567, -6.909605212370625, -0.2448043848277147, 0.32042732695845616, -0.0751812966588838, -1.3141981935711833, -0.20100910287666682, 0.5442207640317085  …  -0.9317953109504982, -3.7895920872786757, 1.0540556964267287, -1.0257932488168306, 0.41183329123279067, 0.394577214016953, -1.0604092270424461, -4.643366432622632, 0.2809074667020363, -0.36346943706216117]
 [0.06760145157771268, 0.4575772753426809, -1.0694988755836974, -5.5258949015719905, -0.20561549311800476, 0.3932042010582691, -0.1124245343922575, -1.295923111382561, -0.08917746429507731, 0.43998248131738726  …  -0.8046406370898734, -2.884498681986517, 1.1935455215199196, -2.0648176620778362, 0.4976081142814483, -0.16245706313349392, -0.988358353314238, -3.471305607870589, 0.2320293389621001, -0.7281675855287556]
 ⋮
 [-0.2412583553028145, -0.4421200297789592, -0.1503614370371623, -0.2590110896322249, -0.18922558905894074, -0.5759061996442362, -0.1643265646620169, -0.4386234616620812, -0.257151875342849, -0.3456347702907449  …  0.07146463506014064, -1.2389370388739436, -0.22481582726525082, -0.7909553088360621, -0.23434351294326128, -0.41878722112142036, -0.23867398519363509, -0.8703023069913709, -0.22816017540976927, -0.23285101070353525]
 [-0.19662399602774008, -0.44142050691056767, -0.08792843416593192, -0.27316590311270084, -0.3661599373040797, -0.4901237024364887, -0.08887791177507688, -0.3818343831700843, -0.22855124408965305, -0.22092580442585522  …  -0.06935782544111459, -1.3332043885258664, -0.1919248642686207, -0.6296052961265688, -0.1993189432272467, -0.37176712739013174, -0.26416369835515624, -0.6638644404269508, -0.27054272879082203, -0.19875045911900743]
 [-0.20568576845804934, -0.46498721152508465, -0.16451131124209667, -0.2944949096828806, -0.3153442665535891, -0.3566506306673232, -0.04581998757356909, -0.4965101560911302, -0.19769286720268228, -0.24720345976527738  …  -0.1668304296689859, -1.3334223201080815, -0.15097558319645588, -0.535071439999606, -0.1894431473689154, -0.28642307760748054, -0.2880248670648779, -0.4832142568930078, -0.31500734014335313, -0.11995361579189205]
 [-0.23139285648270005, -0.42877909868388653, -0.09120548077100175, -0.28332545934378306, -0.3105883267458423, -0.20473613701219298, -0.10920119559832961, -0.5609393174797971, -0.16211760824988902, -0.2294774096669327  …  -0.3392349074716082, -1.0914393121007433, -0.182057433040066, -0.5409023294815721, -0.17479307859776672, -0.27971206388394143, -0.2992571423834019, -0.3069095137012362, -0.29099844739024794, 0.019506939128919595]
 [-0.12169976051981886, -0.4254857664528885, -0.1026482258985125, -0.43518602990924815, -0.2566105023609708, -0.11869049046548048, -0.1445503843116868, -0.503247873732176, -0.20150145474457024, -0.22872125787519215  …  -0.37021389323217696, -0.8026233060100552, -0.1805497135112234, -0.6192352955682797, -0.24292726719109817, -0.2142540509427433, -0.3060163963324449, -0.09662167014270259, -0.2342637813966436, 0.055208946560807735]
 [-0.08322445486227686, -0.5382944722805507, -0.05251078098728926, -0.5194902149204133, -0.20865558885461566, -0.10028567023364027, -0.1883951912697332, -0.5199607493830036, -0.18735496157053724, -0.23506344631780043  …  -0.42158248553819666, -0.6105940466495391, -0.12306042878333869, -0.6163786296359577, -0.1926932958013777, -0.22469591941622383, -0.25399821825246405, -0.07850002581898281, -0.2638774415215151, 0.10165251419781941]
 [-0.08299637105134675, -0.6219274501073628, -0.13552728978801154, -0.6001692012610387, -0.19220578655648748, -0.1719977495581906, -0.2380697074712981, -0.4859911984295907, -0.22983960333075618, -0.11791413483668954  …  -0.4041827463027318, -0.35010090659577586, -0.15659006328059116, -0.5477664038484957, -0.055695179888393835, -0.24464550242115715, -0.19084777303481804, -0.09767671757158795, -0.22079214839529357, 0.13129014865648841]
 [-0.09180012537976534, -0.7028136561537265, -0.18819942758309888, -0.613223878250781, -0.23333556684328657, -0.1453071079260407, -0.25932116824851603, -0.42899145575897846, -0.22314561920404777, -0.06923534174190142  …  -0.34929097913634477, -0.05211099209881928, -0.15927455662013246, -0.44819631466782195, -0.1044992900266235, -0.3598300733467032, -0.1023936653918451, -0.09448539540223364, -0.2461988367743723, 0.03678399026269977]
 [-0.07659099011070217, -0.7219133213054911, -0.2218402128791825, -0.5490336713774219, -0.19235434625372158, -0.07974749833476083, -0.24610153139582291, -0.2509632201487042, -0.13668599933677264, -0.07274096535672679  …  -0.24781280505600262, 0.05318416028571666, -0.16427152021608335, -0.3756541507643358, -0.1906576938928514, -0.4325440328931282, -0.03205331069145864, -0.2261198881194923, -0.21939651638886076, 0.11550953015992861]</code></pre><p>Let us plot the voltage potential of the first couple of components</p><pre><code class="language-julia hljs">v1 = voltage_timeseries(blocks[1], sol)
v2 = voltage_timeseries(blocks[2], sol)

fig = Figure()
ax = Axis(fig[1,1]; xlabel = &quot;time (ms)&quot;, ylabel = &quot;Potential&quot;)
lines!(ax, sol.t, v1)
lines!(ax, sol.t, v2)
xlims!(ax, (0, 1000)) ## limit the x-axis to the first second of simulation
fig</code></pre><img src="eaa0a986.png" alt="Example block output"/><p>To evaluate the connectivity of our simulated resting state network, we calculate the statistically significant correlations</p><pre><code class="language-julia hljs">cs = []
for i in 1:Int((length(sol.t)-1)/1000)-1
    solv = Array(sol[1:2:end,(i-1)*1000+1:(i*1000)])&#39;
    push!(cs,cor(solv))
end
css = stack(cs)

p = zeros(76,76)
for i in 1:76
    for j in 1:76
        p[i,j] = pvalue(OneSampleTTest(css[i,j,:]))
    end
end

heatmap(log10.(p) .* (p .&lt; 0.05))</code></pre><img src="23c729ca.png" alt="Example block output"/><p>Fig.: log10(p value) displaying statistally significant correlation between time series</p><pre><code class="language-julia hljs">heatmap(wm)</code></pre><img src="97dcf012.png" alt="Example block output"/><p>Fig.: Connection Adjacency Matrix that was used to connect the neural mass models</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../parkinsons/">Building a model of Parkinson&#39;s disease using Neural Mass models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 2 October 2024 15:42">Wednesday 2 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
